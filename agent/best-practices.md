# エージェント開発の基本プラクティス

## 常に意識すべきポイント

### 1. コマンド実行後の確認習慣

コマンドを実行した後は、必ず適切な確認コマンドを実行し、期待通りの結果が得られたことを検証します。

```
# 良い例
$ ./gradlew build
$ tree build/libs  # ビルド成果物を確認
$ cat build/reports/tests/test/index.html  # テスト結果を確認
```

**確認方法の例**:
- `tree` コマンドでディレクトリ構造の確認
- `ls -la` でファイル一覧と権限の確認
- `cat`, `less`, `tail` などでログファイルの内容確認
- `ps aux | grep <プロセス名>` でプロセスの実行状態確認
- `curl localhost:<ポート>/<エンドポイント>` でAPIの動作確認
- `git status`, `git diff` でコード変更の確認

### 2. エラー分析と対応のアプローチ

エラーやログを慎重に分析し、解決が難しい場合は以下のステップに従います:

1. エラーメッセージを完全に読み、理解する
2. 関連するログファイルを確認する
3. エラーの根本原因を特定するために複数の情報源を参照する
4. 新しいアプローチを試す前に、一度立ち止まって考察する
5. 必要に応じて設定ファイルやソースコードを確認する
6. **設計との整合性確認**: エラーが設計ドキュメントとの不整合に起因しないか確認する (`docs/` 以下の関連ドキュメントを参照)。

```
# 良い例
$ ./gradlew bootRun
# エラー発生
$ cat build/logs/spring.log  # ログ確認
$ vim src/main/resources/application.properties  # 設定確認
$ git diff  # 最近の変更を確認
```

### 3. 作業前の準備と情報収集

新しい作業を始める前に以下を検討します:

1. どのファイルやログの参照が必要か
2. 必要な前提条件や依存関係は何か
3. トレーニングデータに不足している情報は何か
4. どのような戦略で作業を進めるか
5. **設計ドキュメントの参照**: `docs/` 以下の関連設計ドキュメント（アーキテクチャ、DB設計、API設計など）を必ず確認する。

**準備方法の例**:
- 必要なドキュメントを参照する
- 関連するコードを確認する
- 同様のタスクの過去の例を調査する
- 検索エージェントを使って追加情報を収集する

### 4. コミュニケーションと透明性の維持

- 取っている行動とその理由を明確に説明する
- 不確実な点や複数の選択肢がある場合は、それを正直に伝える
- 進捗状況を定期的に報告する
- 複雑な問題に直面した場合、その複雑さを適切に伝える
- 生成したコードが設計ドキュメントと異なる場合、その理由を明記する。

### 5. 実践的なトラブルシューティング例

#### データベース接続エラーの場合:
```bash
# エラー発生
$ cat logs/application.log  # ログ確認
$ netstat -tulpn | grep <ポート番号>  # DBポートが開いているか確認
$ telnet localhost <DBポート>  # DBへの接続を試みる
$ cat src/main/resources/application.properties  # DB設定を確認
```

#### ビルドエラーの場合:
```bash
# ビルドエラー発生
$ cat build/reports/tests/test/index.html  # テストエラー詳細確認
$ ./gradlew --info build  # 詳細なビルドログを確認
$ ./gradlew dependencies  # 依存関係を確認
```

### 6. ハルシネーションへの対応 (新規追加)
- **存在しないコードの参照**: 生成されたコードがプロジェクト内に存在しないクラスやメソッドを参照していないか確認する。
- **依存関係の確認**: 追加された依存関係が `build.gradle.kts` に正しく記述され、実際可能か確認する。
- **設計との照合**: 生成されたコード（特にエンティティ、APIエンドポイント、データ構造）が `docs/` 以下の設計ドキュメントと一致しているか常に確認する。不一致の場合は、設計ドキュメントを根拠として修正を促す。

## 応用プラクティス

### CI/CD環境での運用
- テスト自動化とその結果確認の手順化
- デプロイ後の健全性チェックスクリプトの準備
- ロールバック手順の明確化

### パフォーマンス最適化
- 定期的なパフォーマンスメトリクス測定
- ボトルネック特定のための計測ポイント設定
- 負荷テストシナリオの準備

---

これらのプラクティスを常に意識し、問題解決力と開発効率の向上を目指します。
